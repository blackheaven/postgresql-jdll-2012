<!doctype html>

<html lang="fr">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=1024" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <title>Introduction à PostgreSQL | par Geoffroy BAILLY et Gautier DI FOLCO</title>
    
    <meta name="description" content="Introduction à PostgreSQL, le SGBD Opensource le plus avancé !" />
    <meta name="author" content="Bartek Szopka" />

    <link href="http://fonts.googleapis.com/css?family=Open+Sans:regular,semibold,italic,italicsemibold|PT+Sans:400,700,400italic,700italic|PT+Serif:400,700,400italic,700italic" rel="stylesheet" />

    <link href="css/main.css" rel="stylesheet" />
    <link rel="stylesheet" href="lib/highlight.js/src/styles/solarized_dark.css">

    <link rel="shortcut icon" href="lib/impress.js/favicon.png" />
    <link rel="apple-touch-icon" href="lib/impress.js/apple-touch-icon.png" />
</head>

<body class="impress-not-supported">

<div class="fallback-message">
    <p>Your browser <b>doesn't support the features required</b> by impress.js, so you are presented with a simplified version of this presentation.</p>
    <p>For the best experience please use the latest <b>Chrome</b>, <b>Safari</b> or <b>Firefox</b> browser.</p>
</div>

<!--
    
    Now that's the core element used by impress.js.
    
    That's the wrapper for your presentation steps. In this element all the impress.js magic happens.
    It doesn't have to be a `<div>`. Only `id` is important here as that's how the script find it.
    
    You probably won't need it now, but there are some configuration options that can be set on this element.
    
    To change the duration of the transition between slides use `data-transition-duration="2000"` giving it
    a number of ms. It defaults to 1000 (1s).
    
    You can also control the perspective with `data-perspective="500"` giving it a number of pixels.
    It defaults to 1000. You can set it to 0 if you don't want any 3D effects.
    If you are willing to change this value make sure you understand how CSS perspective works:
    https://developer.mozilla.org/en/CSS/perspective
    
    But as I said, you won't need it for now, so don't worry - there are some simple but interesing things
    right around the corner of this tag ;)
    
-->
<div id="impress">

    <!--
        
        This is an example of step element being scaled.
        
        Again, we use a `data-` attribute, this time it's `data-scale="4"`, so it means that this
        element will be 4 times larger than the others.
        From presentation and transitions point of view it means, that it will have to be scaled
        down (4 times) to make it back to it's correct size.
        
    -->
    <div id="titre" class="step" data-x="900" data-y="-4000" data-scale="3">
        <h1>Introduction à <strong>PostgreSQL</strong></h1>
        <span class="footnote">par Geoffroy BAILLY et Gautier DI FOLCO</span>
    </div>

    <div id="contenu" class="step" data-x="3700" data-y="-3950" data-rotate="32" data-scale="2">
        <h1>Ce que contient cette présentation</h1>
        <ul>
          <li>Présentation</li>
          <li>La base</li>
            <ul>
              <li>Indexes</li>
              <li>VACUUM</li>
              <li>EXPLAIN</li>
              <li>Recherche plein texte</li>
              <li>Procédures stockées</li>
              <li>Triggers</li>
            </ul>
          <li>Outils</li>
            <ul>
              <li>PgAdmin</li>
              <li>Réplication</li>
              <li>Surveillance</li>
            </ul>
          <li>Extensions</li>
            <ul>
              <li>PGXN</li>
              <li>PostGIS</li>
              <li>Foreign Data Wrapper</li>
            </ul>
          <li>Vers l'infini et au delà</li>
        </ul>
    </div>

    <div id="non-contenu" class="step" data-x="4400" data-y="-1600" data-rotate="95" data-scale="2">
        <h1>Ce que ne contient pas cette présentation</h1>
        <ul>
          <li>Benchmark</li>
          <li>Comparaison avec d'autre SGBD</li>
          <li>Introduction au SQL</li>
          <li>Procédure complète de mise en place</li>
        </ul>
        <blockquote>
          Les chiffres sont aux analystes ce que les lampadaires sont aux ivrognes, ils fournissent bien plus un appui qu'un éclairage.
          <span class="author">Jean Dion</span>
        </blockquote>
    </div>

    <div id="histoire" class="step" data-x="4000" data-y="2000" data-scale="1">
        <h1>Historique</h1>
        <ul>
          <li>1977-1985 : Ingres encradré par Michael Stonebraker</li>
          <li>1986 : Postgres</li>
          <li>1995 : Intégration du SQL (Postres95)</li>
          <li>1996 : PostgreSQL, passage à l'OpenSource et création du PostgreSQL Global Development Group</li>
        </ul>
    </div>

    <div id="caracteristiques" class="step" data-x="150" data-y="2000" data-scale="1">
        <h1>Caractéristiques</h1>
        <ul>
          <li>License : PostgreSQL (ISC),</li>
          <li>Versions : 8.3, 8.4, 9.0, 9.1, 9.2 (et bientôt 9.3),</li>
          <li>Bon support de SQL:2011 (160+/179), SQL/MED,</li>
          <li>Support ACID/MVCC,</li>
          <li>PostgreSQL Global Development Group :</li>
          <ul>
            <li>6 membres de la Core Team</li>
            <li>38 contributeurs majeurs</li>
            <li>40 contributeurs</li>
            <li>100 contributeurs occasionnels</li>
          </ul>
          <li>Très peu de limitations : 32 To par tables, 1 To par champs, 1.6 To par lignes et 250 à 1.600 colonnes par tabes.</li>
        </ul>
    </div>

    <div id="installation" class="step" data-x="-500" data-y="2500" data-scale="1">
        <h1>Installation</h1>
        <pre class="bash"><code>$ sudo apt-get install postgresql
$ sudo yum install postgresql-server</code></pre>
    </div>

    <div id="vacuum2" class="step" data-x="3200" data-y="-200" data-rotate="90" data-scale="2">
        <h1>INDEX</h1>
        Explications
    </div>

    <div id="pl" class="step" data-x="-1100" data-y="-1400" data-scale="1">
        <h1>INDEX</h1>
        Explications
    </div>

    <div id="pl2" class="step" data-x="-0800" data-y="900" data-rotate="110" data-scale="3">
        <h1>INDEX</h1>
        Explications
    </div>

    <div id="pl3" class="step" data-x="-1500" data-y="-2400" data-rotate="180" data-scale="1">
        <h1>VACUUM</h1>
        Explications
    </div>

    <div id="pl4" class="step" data-x="3400" data-y="-2700" data-scale="1">
        <h1>VACUUM</h1>
        Explications
    </div>

    <div id="pl5" class="step" data-x="0600" data-y="-1000" data-rotate="-90" data-scale="2">
        <h1>VACUUM</h1>
        Explications
    </div>

    <div id="explain" class="step" data-x="2000" data-y="-1000" data-rotate="90" data-scale="2">
        <h1>EXPLAIN</h1>
        <ul>
          <li>Détaille une requête,</li>
          <li>Affiche les coûts (estimés et réels),</li>
          <li>Permet l'optimisation des requêtes,</li>
          <li>Affichage de chaque noeud de traitement.</li>
      </ul>

        <pre><code>EXPLAIN ANALYSE requete;</code></pre>
    </div>

    <div id="explain2" class="step" data-x="0200" data-y="0700" data-rotate="-65" data-scale="1">
        <h1>EXPLAIN</h1>
        <pre><code>EXPLAIN ANALYSE SELECT O.*
FROM customers C, orders O
WHERE O.customerid = C.customerid;</code></pre>
<pre><code class="small"> Hash Join  (cost=915.00..1429.00 rows=12000 width=30)
                   (actual time=60.494..114.822 rows=12000 loops=1)
   Hash Cond: (o.customerid = c.customerid)
   ->  Seq Scan on orders o  (cost=0.00..214.00 rows=12000 width=30)
                                              (actual time=0.012..16.502 rows=12000 loops=1)
   ->  Hash  (cost=665.00..665.00 rows=20000 width=4)
                   (actual time=60.458..60.458 rows=20000 loops=1)
         Buckets: 2048  Batches: 1  Memory Usage: 469kB
         ->  Seq Scan on customers c  (cost=0.00..665.00 rows=20000 width=4)
                                                  (actual time=0.008..30.644 rows=20000 loops=1)
 Total runtime: 129.912 ms</code></pre>
    </div>

    <div id="explain3" class="step" data-x="2800" data-y="1000" data-rotate="65" data-scale="2">
        <h1>EXPLAIN</h1>
        <pre><code>EXPLAIN ANALYSE
SELECT C.customerid, SUM(O.totalamount) gain
FROM customers C, orders O
WHERE O.customerid = C.customerid
GROUP BY C.customerid ORDER BY gain DESC;</code></pre>
    </div>

    <div id="explain4" class="step" data-x="2800" data-y="1000" data-rotate="65" data-scale="2">
<pre><code class="small">
 Sort  (cost=2817.54..2847.54 rows=12000 width=10)
            (actual time=194.181..205.802 rows=8996 loops=1)
   Sort Key: (sum(o.totalamount))
   Sort Method: quicksort  Memory: 608kB
   ->  GroupAggregate  (cost=0.05..2004.49 rows=12000 width=10)
                                    (actual time=0.077..158.349 rows=8996 loops=1)
         ->  Merge Join  (cost=0.05..1824.49 rows=12000 width=10)
                                            (actual time=0.054..122.390 rows=12000 loops=1)
               Merge Cond: (c.customerid = o.customerid)
               ->  Index Scan using customers_pkey on customers c
                    (cost=0.00..952.25 rows=20000 width=4)
                    (actual time=0.021..32.855 rows=20000 loops=1)
               ->  Index Scan using ix_order_custid on orders o 
                        (cost=0.00..672.24 rows=12000 width=10)
                        (actual time=0.018..24.793 rows=12000 loops=1)
 Total runtime: 217.261 ms</code></pre>
    </div>

    <div id="plein-texte" class="step" data-x="2800" data-y="2400" data-rotate="90" data-scale="2">
        <h1>Recherche plein-texte : classique</h1>
        <pre><code>SELECT * FROM messages
WHERE contenu LIKE '%travail%';</code></pre>
    </div>

    <div id="plein-texte2" class="step" data-x="2700" data-y="3700" data-rotate="100" data-scale="1">
        <h1>Recherche plein-texte : le contenu</h1>
        <pre><code>SELECT to_tsvector('a fat cat sat on
a mat and ate a fat rat');</code></pre>
        donne
        <pre><code>'ate':9 'cat':3 'fat':2,11 'mat':7 'rat':12
'sat':4</code></pre>
    </div>

    <div id="plein-texte3" class="step" data-x="2000" data-y="4800" data-scale="2">
        <h1>Recherche plein-texte : la requête</h1>
        <pre><code>SELECT to_tsquery('cat & rat');</code></pre>
        donne
        <pre><code>'cat' & 'rat'</code></pre>
    </div>

    <div id="plein-texte4" class="step" data-x="1000" data-y="3000" data-rotate="-90" data-scale="2">
        <h1>Recherche plein-texte : le choc</h1>
        <pre><code>SELECT * FROM messages
WHERE to_tsvector(contenu)
@@ to_tsquery('cat & rat');</code></pre>
    </div>

    <div id="plein-texte5" class="step" data-x="-2500" data-y="-4200" data-scale="2">
        <h1>Recherche plein-texte : la vitesse</h1>
        <ul>
          <li>GiST</li>
          <ul>
            <li>Index à perte (faux positifs),</li>
            <li>3 fois plus rapide à se construire,</li>
            <li>3 fois plus lent lors de la recherche.</li>
          </ul>
          <li>GIN</li>
          <ul>
            <li>Consommation disque 2 à 3 fois plus grande,</li>
            <li>Mise à jour légèrement plus longue (10 fois plus longue si la mise à jour automatique est désactivée),</li>
            <li>Performances de construction liée à la mémoire disponible,</li>
          </ul>
        </ul>
    </div>

    <div id="pl" class="step" data-x="-4200" data-y="-2200" data-rotate="90" data-scale="2">
        <h1>PL</h1>
        Explications
    </div>

    <div id="fdw_" class="step" data-x="-2200" data-y="-2600" data-rotate="110" data-scale="2">
        <h1>Triggers</h1>
        Explications
    </div>

    <div id="fdw2_" class="step" data-x="-3800" data-y="-400" data-rotate="75" data-scale="2">
        <h1>Triggers</h1>
        Explications
    </div>

    <div id="fdw3_" class="step" data-x="-2400" data-y="-200" data-rotate="-100" data-scale="2">
        <h1>Triggers</h1>
        Explications
    </div>

    <div id="fdw4_" class="step" data-x="-3400" data-y="1200" data-rotate="80" data-scale="2">
        <h1>Triggers</h1>
        Explications
    </div>

    <div id="fdw5" class="step" data-x="-2000" data-y="2100" data-scale="2">
        <h1>FDW</h1>
        Explications
    </div>

    <div id="extensions" class="step" data-x="5000" data-y="-4800" data-rotate="-120" data-scale="2">
        <h1>Extensions</h1>
        IMG
    </div>

    <div id="pgxn" class="step" data-x="5800" data-y="-3200" data-rotate="-80" data-scale="2">
        <h1>PGXN</h1>
        <ul>
          <li>PostgreSQL Extension network,</li>
          <li>créé en Mai 2011 suite à la PGCon,</li>
          <li>il a pour but de regrouper les extensions disponible,</li>
          <li>93 extensions et 88 distributions,</li>
        </ul>

        Outils
        <ul>
          <li><b>PGXN Manager :</b> Infrastructure pour les développeurs.</li>
          <li><b>PGXN API :</b> API pour les extensions.</li>
          <li><b>PGXN Search :</b> Site web qui contient les extensions et leur documentation.</li>
          <li><b>PGXN Client :</b> programme en ligne de commande pour télécharger, tester et installer les extensions.</li>
        </ul>
    </div>

    <div id="pgxn-client" class="step" data-x="5100" data-y="-0200" data-rotate="-60" data-scale="2">
        <h1>PGXN Client</h1>
        Utilisation :
        <pre><code class="bash">$ pgxn install ext
$ pgxn load -d db ext</code></pre>
    </div>

    <div id="postgis" class="step" data-x="3400" data-y="3600" data-rotate="-80" data-scale="2">
        <h1>PostGIS</h1>
        <ul>
          <li>Standards ISO et OGC : ISO 19125, SQL/MM, SFS 1.2.0.</li>
          <li>Gestion de données géographiques,</li>
          <li>Gestion de données géométrique : 2D, 3D et 4D.</li>
          <li>Gestion des graphes,</li>
          <li>Conforme à SQL/MM,</li>
          <li>Transformations, projections, agorithmes courants, etc.</li>
          <li>Possibilité de mettre des (SP-)GiST pour accélérer les recherches,</li>
          <li>Utilisation facilitité avec OpenStreetMap.</li>
        </ul>
    </div>

    <div id="fdw" class="step" data-x="3600" data-y="7000" data-rotate="80" data-scale="2">
        <h1>Foreign Data Wrapper</h1>
        <ul>
          <li>Standard  SQL/MED (SQL Management of External Data),</li>
          <li>Permet de gérer des sources externes de données,</li>
          <li>Définies comme tables,</li>
          <li>Impossible de poser des contraintes,</li>
          <li>La majorité se trouvent sur PGXN,</li>
          <li>Plus de 20 wrappers actuellement.</li>
        </ul>
        <pre><code>CREATE FOREIGN TABLE passwd (
username text, pass text, uid int4, gid int4,
gecos text, home text, shell text
) SERVER file_server OPTIONS (format 'text',
filename '/etc/passwd', delimiter ':', null '');</code></pre>
        utilisation comme une table normale :
        <pre><code>SELECT * FROM passwd
ORDER BY uid ASC LIMIT 3;</code></pre>
    </div>

    <div id="fdw2" class="step" data-x="5200" data-y="7000" data-rotate="80" data-scale="2">
        <h1>Foreign Data Wrapper : liste</h1>
        <ul>
          <li>Principaux SGBDR : oracle_fdw, mysql_fdw, tds_fdw (Microsoft SQL Server), odbc_fdw, jdbc_fdw.</li>
          <li>Principaux SGBD NoSQL : couchdb_fdw, mongo_fdw, redis_fdw.</li>
          <li>Fichiers : file_fdw, file_text_array_fdw, fixed_file_length.</li>
          <li>Autres : twitter_fdw, ldap_fdw, s3_fdw (Amazon S3), www_fdw, PGStrom (GPU).</li>
          <li>Multicorn (Python) : sqlalchemyfdw, fsfdw, csvfdw, rssfdw, hivefdw.</li>
        </ul>
    </div>

    <div id="nosql" class="step" data-x="6000" data-y="7000" data-rotate="80" data-scale="2">
        <h1>NoSQL</h1>
        <ul>
          <li>API HTTP RESTful (presque) et RPC (ngx_postgres),</li>
          <li>Support de map/reduce,</li>
          <li><b>Clé-valeur :</b> modèle actuel,</li>
          <li><b>Colonne :</b> modèle actuel / hstore (GiST),</li>
          <li><b>Graphe :</b> PostGIS (GiST),</li>
          <li><b>Document :</b> JSON (GiST).</li>
        </ul>
    </div>

    <div id="nosql2" class="step" data-x="7000" data-y="7000" data-rotate="80" data-scale="2">
        <h1>NoSQL : hstore</h1>
        <pre><code>SELECT 'foo=>bar'::hstore;</code></pre>
        <pre><code>SELECT doc -> ‘text’ as tweet,
doc -> ‘created_at’ as created_at
FROM tweets
WHERE doc @> ‘created_at=>00001323446095’;</code></pre>
    </div>

    <div id="nosql3" class="step" data-x="8000" data-y="7000" data-rotate="80" data-scale="2">
        <h1>NoSQL : JSON</h1>
        <pre><code>SELECT json_array_agg(...) FROM ...</code></pre>
        <pre><code>SELECT json_object_agg(...) FROM ...</code></pre>
        <pre><code>CREATE INDEX clef_in_json
ON messages (jmember(jsonfield,'titre'));</code></pre>
        <pre><code>SELECT * FROM messages
WHERE jmember(jsonfield, 'titre') = 'foo';</code></pre>
    </div>

    <div id="asynchrone" class="step" data-x="9000" data-y="7000" data-rotate="80" data-scale="2">
        <h1>Event Driven Architecture</h1>

        <ul>
          <li>C10k problem,</li>
          <li>libpq,</li>
          <li>depuis la 7.1 (au moins), en 2001.</li>
        </ul>

        Exemple :
        <ul>
          <li>libevent (NGINX),</li>
          <li>EventMachine (Ruby : Thin, Rack, RoR),</li>
          <li>Node.js,</li>
          <li>ActiveMQ, RabbitMQ, ZeroMQ, etc.</li>
        </ul>
    </div>

    <!--
        
        So to make a summary of all the possible attributes used to position presentation steps, we have:
        
        * `data-x`, `data-y`, `data-z` - they define the position of **the center** of step element on
            the canvas in pixels; their default value is 0;
        * `data-rotate-x`, `data-rotate-y`, 'data-rotate-z`, `data-rotate` - they define the rotation of
            the element around given axis in degrees; their default value is 0; `data-rotate` and `data-rotate-z`
            are exactly the same;
        * `data-scale` - defines the scale of step element; default value is 1
        
        These values are used by impress.js in CSS transformation functions, so for more information consult
        CSS transfrom docs: https://developer.mozilla.org/en/CSS/transform
        
    -->
    <div id="overview" class="step" data-x="1000" data-y="0500" data-scale="15">
        <img src="img/logo.svg" width="90%" height="90%" />
    </div>

</div>

<script src="lib/impress.js/js/impress.js"></script>
<script>impress().init();</script>
<script src="lib/highlight.js/build/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

</body>
</html>
