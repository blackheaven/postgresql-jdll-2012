<!doctype html>

<html lang="fr">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=1024" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <title>Introduction à PostgreSQL | par Geoffroy BAILLY et Gautier DI FOLCO</title>

    <meta name="description" content="Introduction à PostgreSQL, le SGBD Opensource le plus avancé !" />
    <meta name="author" content="JFD" />

    <link href="http://fonts.googleapis.com/css?family=Open+Sans:regular,semibold,italic,italicsemibold|PT+Sans:400,700,400italic,700italic|PT+Serif:400,700,400italic,700italic" rel="stylesheet" />

    <link href="css/main.css" rel="stylesheet" />
    <link rel="stylesheet" href="lib/highlight.js/src/styles/solarized_dark.css">

    <link rel="shortcut icon" href="lib/impress.js/favicon.png" />
    <link rel="apple-touch-icon" href="lib/impress.js/apple-touch-icon.png" />
</head>

<body class="impress-not-supported">

<div class="fallback-message">
    <p>Your browser <b>doesn't support the features required</b> by impress.js, so you are presented with a simplified version of this presentation.</p>
    <p>For the best experience please use the latest <b>Chrome</b>, <b>Safari</b> or <b>Firefox</b> browser.</p>
</div>

<!--

    Now that's the core element used by impress.js.

    That's the wrapper for your presentation steps. In this element all the impress.js magic happens.
    It doesn't have to be a `<div>`. Only `id` is important here as that's how the script find it.

    You probably won't need it now, but there are some configuration options that can be set on this element.

    To change the duration of the transition between slides use `data-transition-duration="2000"` giving it
    a number of ms. It defaults to 1000 (1s).

    You can also control the perspective with `data-perspective="500"` giving it a number of pixels.
    It defaults to 1000. You can set it to 0 if you don't want any 3D effects.
    If you are willing to change this value make sure you understand how CSS perspective works:
    https://developer.mozilla.org/en/CSS/perspective

    But as I said, you won't need it for now, so don't worry - there are some simple but interesing things
    right around the corner of this tag ;)

-->
<div id="impress">

    <!--

        This is an example of step element being scaled.

        Again, we use a `data-` attribute, this time it's `data-scale="4"`, so it means that this
        element will be 4 times larger than the others.
        From presentation and transitions point of view it means, that it will have to be scaled
        down (4 times) to make it back to it's correct size.

    -->
    <div id="titre" class="step" data-x="900" data-y="-4000" data-scale="3">
        <h1>Introduction à <strong>PostgreSQL</strong></h1>
        <span class="footnote">par Geoffroy BAILLY et Gautier DI FOLCO</span>
    </div>

    <div id="contenu" class="step" data-x="3800" data-y="-4000" data-rotate="-32" data-scale="1">
        <h1>Ce que contient cette présentation</h1>
        <ul>
          <li>Présentation</li>
          <li>La base</li>
            <ul>
              <li>Indexes</li>
              <li>VACUUM</li>
              <li>EXPLAIN</li>
              <li>Recherche plein texte</li>
              <li>Procédures stockées</li>
              <li>Triggers</li>
            </ul>
          <li>Outils</li>
            <ul>
              <li>PgAdmin</li>
              <li>Réplication (quelques mots)</li>
              <li>Surveillance</li>
            </ul>
          <li>Extensions</li>
            <ul>
              <li>PGXN</li>
              <li>PostGIS</li>
              <li>Foreign Data Wrapper</li>
            </ul>
          <li>Vers l'infini et au delà</li>
        </ul>
    </div>

    <div id="non-contenu" class="step" data-x="4500" data-y="-2500" data-rotate="-32" data-scale="1">
        <h1>Ce que ne contient pas cette présentation</h1>
        <ul>
          <li>Introduction au SQL</li>
          <li>Procédure complète de mise en place</li>
          <li>Comparaison avec d'autre SGBD</li>
          <li>Benchmark</li>
        </ul>
        <br />
        <blockquote>
          Les chiffres sont aux analystes ce que les lampadaires sont aux ivrognes, ils fournissent bien plus un appui qu'un éclairage.
          <span class="author">Jean Dion</span>
        </blockquote>
    </div>

    <div id="histoire" class="step" data-x="4000" data-y="2000" data-scale="1">
        <h1>Historique</h1>
        <ul>
          <li>1977-1985 : Ingres encradré par Michael Stonebraker</li>
          <li>1986 : Postgres</li>
          <li>1995 : Intégration du SQL (Postres95)</li>
          <li>1996 : PostgreSQL, passage à l'OpenSource et création du PostgreSQL Global Development Group</li>
        </ul>
    </div>

    <div id="caracteristiques" class="step" data-x="4000" data-y="3000" data-scale="1">
        <h1>Caractéristiques</h1>
        <ul>
          <li>License : PostgreSQL (ISC),</li>
          <li>Versions : 8.3, 8.4, 9.0, 9.1, 9.2 (et 9.3 dans 10 mois),</li>
          <li>Bon support de SQL:2011 (160+/179), SQL/MED,</li>
          <li>Support ACID/MVCC,</li>
          <li>PostgreSQL Global Development Group :</li>
          <ul>
            <li>6 membres de la Core Team</li>
            <li>38 contributeurs majeurs</li>
            <li>40 contributeurs</li>
            <li>100 contributeurs occasionnels</li>
          </ul>
          <li>Très peu de limitations : 32 To par tables, 1 Go par champs, 1.6 To par lignes et 250 à 1.600 colonnes par tables.</li>
        </ul>
    </div>

    <div id="entreprises" class="step" data-x="4000" data-y="4000" data-scale="1">
        <h1>Entreprises</h1>

        Support :
        <ul>
          <li>EntrepriseDB,</li>
          <li>Dalibo,</li>
          <li>2ndQuadrant,</li>
          <li>Bull.</li>
        </ul>

        Utilisateurs :
        <ul>
          <li>Apple,</li>
          <li>Cisco,</li>
          <li>État Français,</li>
          <li>HP,</li>
          <li>IMDB.com, The Internet Movie Database,</li>
          <li>Juniper,</li>
          <li>leboncoin.fr,</li>
          <li>Skype.</li>
          <li>Sourceforge,</li>
          <li>Sun Microsystem,</li>
          <li>Yahoo.</li>
        </ul>
    </div>

    <div id="installation" class="step" data-x="-500" data-y="2420" data-rotate="-20" data-scale="1">
        <h1>Installation</h1>
        <pre class="bash"><code>$ sudo apt-get install postgresql
$ sudo yum install postgresql-server</code></pre>
    </div>

    <div id="index" class="step" data-x="-1100" data-y="-1500" data-scale="1">
        <h1>INDEX</h1>
        <ul>
            <li>Création d'un arbre de recherche</li>
            <li>SELECT/UPDATE mais aussi les jointures</li>
            <li>Evite de lire l'ensemble de la table</li>
            <li>Utilise ANALYSE pour optimiser la recherche</li>
            <li>Coût en ressources serveur (synchronisation)</li>
        </ul>
    </div>

    <div id="analyse" class="step" data-x="-1100" data-y="-1000" data-scale="1">
        <h1>ANALYZE</h1>
        Met à jour les statistiques sur les données pour l'optimisateur de requête
    </div>

    <div id="index2" class="step" data-x="-1100" data-y="-0500" data-scale="1">
        <h1>INDEX</h1>
        <ul>
			<li>Index uniques</li>
			<li>Index multicolonnes</li>
			<li>CLUSTER: réorganisation de la table selon l'index</li>              
			<li>Verrou sur la table (modification impossible)</li>        
			<li>Plusieurs types: B-tree, GIN, Hash, GiST</li>        
        </ul>
    </div>

    <div id="vacuum" class="step" data-x="3300" data-y="-1400" data-scale="1">
        <h1>VACUUM</h1>
        <ul>
            <li>Recherche l'espace libre d'une table (lignes mortes)</li>
            <li>S'applique à une table ou une colonne particulière</li>
            <li>Hors normes SQL</li>
        </ul>
    </div>

    <div id="vacuum2" class="step" data-x="3300" data-y="-0900" data-scale="1">
        <h1>VACUUM</h1>
        <ul>
            <li>Un mode classique</li>
            <li>Un mode <b>full</b>:
                <ul>
                    <li>Réécriture de la table dans un nouveau fichier</li>
                    <li>Récupère plus d'espace</li>
                    <li>Bloque la table (verrou exclusif)</li>
                </ul>
            </li>
        </ul>
    </div>

    <div id="vacuum3" class="step" data-x="3400" data-y="-0400" data-scale="1">
        <h1>AUTO_VACUUM</h1>
        <ul>
            <li>deamon d'automatisation VACUUM/ANALYZE</li>
            <li>paramètrable via cron</li>
            <li>Utilise les statistiques (track_counts = true)</li>
            <li>'autovacuumlauncher' gèrant des 'autovacuumworker'</li>
        </ul>
    </div>

    <div id="explain" class="step" data-x="1400" data-y="1500" data-scale="1">
        <h1>EXPLAIN</h1>
        <ul>
          <li>Détaille une requête,</li>
          <li>Affiche les coûts (estimés et réels),</li>
          <li>Permet l'optimisation des requêtes,</li>
          <li>Affichage de chaque noeud de traitement.</li>
      </ul>

        <pre><code>EXPLAIN ANALYSE requete;</code></pre>
    </div>

    <div id="explain2" class="step" data-x="1400" data-y="2500" data-scale="1">
        <h1>EXPLAIN</h1>
        <pre><code>EXPLAIN ANALYSE SELECT O.*
FROM customers C, orders O
WHERE O.customerid = C.customerid;</code></pre>
<pre><code class="small"> Hash Join  (cost=915.00..1429.00 rows=12000 width=30)
                   (actual time=60.494..114.822 rows=12000 loops=1)
   Hash Cond: (o.customerid = c.customerid)
   ->  Seq Scan on orders o  (cost=0.00..214.00 rows=12000 width=30)
                                              (actual time=0.012..16.502 rows=12000 loops=1)
   ->  Hash  (cost=665.00..665.00 rows=20000 width=4)
                   (actual time=60.458..60.458 rows=20000 loops=1)
         Buckets: 2048  Batches: 1  Memory Usage: 469kB
         ->  Seq Scan on customers c  (cost=0.00..665.00 rows=20000 width=4)
                                                  (actual time=0.008..30.644 rows=20000 loops=1)
 Total runtime: 129.912 ms</code></pre>
    </div>

    <div id="explain3" class="step" data-x="1400" data-y="3500" data-scale="1">
        <h1>EXPLAIN</h1>
        <pre><code>EXPLAIN ANALYSE
SELECT C.customerid, SUM(O.totalamount) gain
FROM customers C, orders O
WHERE O.customerid = C.customerid
GROUP BY C.customerid ORDER BY gain DESC;</code></pre>
    </div>

    <div id="explain4" class="step" data-x="1400" data-y="4500" data-scale="1">
<pre><code class="small">
 Sort  (cost=2817.54..2847.54 rows=12000 width=10)
            (actual time=194.181..205.802 rows=8996 loops=1)
   Sort Key: (sum(o.totalamount))
   Sort Method: quicksort  Memory: 608kB
   ->  GroupAggregate  (cost=0.05..2004.49 rows=12000 width=10)
                                    (actual time=0.077..158.349 rows=8996 loops=1)
         ->  Merge Join  (cost=0.05..1824.49 rows=12000 width=10)
                                            (actual time=0.054..122.390 rows=12000 loops=1)
               Merge Cond: (c.customerid = o.customerid)
               ->  Index Scan using customers_pkey on customers c
                    (cost=0.00..952.25 rows=20000 width=4)
                    (actual time=0.021..32.855 rows=20000 loops=1)
               ->  Index Scan using ix_order_custid on orders o
                        (cost=0.00..672.24 rows=12000 width=10)
                        (actual time=0.018..24.793 rows=12000 loops=1)
 Total runtime: 217.261 ms</code></pre>
    </div>

    <div id="plein-texte" class="step" data-x="-3000" data-y="-4000" data-scale="1">
        <h1>Recherche plein-texte</h1>
        <pre><code>SELECT * FROM messages
WHERE contenu LIKE '%messages%';</code></pre>
    </div>

    <div id="plein-texte2" class="step" data-x="-3000" data-y="-2000" data-scale="1">
        <h1>Recherche plein-texte 2.0</h1>
        <pre><code>SELECT * FROM messages
WHERE to_tsvector(contenu)
@@ to_tsquery('cat & rat');</code></pre>
    </div>

    <div id="pgxn" class="step" data-x="-3000" data-y="1000" data-scale="1">
        <h1>PGXN</h1>
        <ul>
          <li>PostgreSQL Extension network,</li>
          <li>créé en Mai 2011 suite à la PGCon,</li>
          <li>il a pour but de regrouper les extensions disponible,</li>
          <li>93 extensions et 88 distributions.</li>
        </ul>

        Outils
        <ul>
          <li><b>PGXN Manager :</b> Infrastructure pour les développeurs.</li>
          <li><b>PGXN API :</b> API pour les extensions.</li>
          <li><b>PGXN Search :</b> Site web qui contient les extensions et leur documentation.</li>
          <li><b>PGXN Client :</b> programme en ligne de commande pour télécharger, tester et installer les extensions.</li>
        </ul>
    </div>

    <div id="pgxn-client" class="step" data-x="-2700" data-y="2000" data-scale="1">
        <h1>PGXN Client</h1>
        Utilisation :
        <pre><code class="bash">$ pgxn install ext
$ pgxn load -d db ext</code></pre>
    </div>

    <div id="postgis" class="step" data-x="1000" data-y="-1500" data-scale="1">
        <h1>PostGIS</h1>
        <ul>
          <li>Standards ISO et OGC : ISO 19125, SQL/MM, SFS 1.2.0.</li>
          <li>Gestion de données géographiques,</li>
          <li>Gestion de données géométrique : 2D, 3D et 4D.</li>
          <li>Gestion des graphes,</li>
          <li>Conforme à SQL/MM,</li>
          <li>Transformations, projections, agorithmes courants, etc.</li>
          <li>Possibilité de mettre des (SP-)GiST pour accélérer les recherches,</li>
          <li>Utilisation facilitité avec OpenStreetMap.</li>
        </ul>
    </div>

    <div id="fdw" class="step" data-x="1000" data-y="-0500" data-scale="1">
        <h1>Foreign Data Wrapper</h1>
        <ul>
          <li>Standard  SQL/MED (SQL Management of External Data),</li>
          <li>Permet de gérer des sources externes de données,</li>
          <li>Définies comme tables,</li>
          <li>Impossible de poser des contraintes,</li>
          <li>La majorité se trouvent sur PGXN,</li>
          <li>Plus de 20 wrappers actuellement.</li>
        </ul>
        <pre><code>CREATE FOREIGN TABLE passwd (
username text, pass text, uid int4, gid int4,
gecos text, home text, shell text
) SERVER file_server OPTIONS (format 'text',
filename '/etc/passwd', delimiter ':', null '');</code></pre>
        utilisation comme une table normale :
        <pre><code>SELECT * FROM passwd
ORDER BY uid ASC LIMIT 3;</code></pre>
    </div>

    <div id="replication1" class="step" data-x="4500" data-y="-1500" data-scale="1">
        <h1>Réplication</h1>

        Plusieurs objectifs:
        <ul>
            <li>Sauvegarde</li>
            <li>Synchronisation</li>
            <li>Haute-disponibilité</li>
        </ul>

        <br />
        Plusieurs moyens :
        <ul>
            <li>Réplication par journaux (log shipping)</li>
            <li>Réplication par triggers</li>
            <li>Réplication des instructions</li>
        </ul>
    </div>


    <div id="replication2" class="step" data-x="6000" data-y="-1500" data-scale="1">
        <h2>Réplication par journaux XLOG</h2>
        <ul>
            <li>Pas d'outils externe</li>
            <li>Simple à mettre en place</li>
            <li>Serveur fils inaccessible</li>
        </ul>

		<br />
        <h2>Réplication par triggers</h2>
        <ul>
            <li>Outils externes: Slony/Londiste</li>
            <li>Pas de synchronisation de la structure des tables</li>
            <li>Faible documentation</li>
            <li>Serveur fils en lecture seule</li>
        </ul>
        
		<br />
        <h2>Réplication des instructions</h2>
        <ul>
            <li>Envoi des requêtes à tous les serveurs</li>
            <li>pgPool-II: <i>poller</i> de connexions</li>
            <li>Le plus simple à utiliser</li>
            <li>Serveurs fils accessibles via le <i>pooler</i></li>
        </ul>
    </div>

    <div id="pgadmin" class="step" data-x="-1100" data-y="0" data-scale="1">
        <h1>PgAdmin</h1>

        Outil graphique de référence:
        <ul>
            <li>Visualisation des données</li>
            <li>Édition des objets (tables, lignes, utilisateurs, ...)</li>
            <li>Modification des fichiers de configuration</li>
            <li>Suit l'évolution de Postgres</li>
            <li>Plugins</li>
        </ul>
    </div>

    <div id="surveillance" class="step" data-x="-600" data-y="500" data-scale="1">
        <h1>Surveillance</h1>

        <ul>
            <li>Journaux: connexions, erreurs de requêtes et durées d'exécution</li>
            <li>Nagiosplugin et postBix pour Zabbix</li>
            <li>PgBadger (ex-pgFouine): rapports d'analyse des logs</li>
            <li>Postgres System Impact report: analyse de logs</li>
            <li>vues pg_stat* et modules pgStats </li>
        </ul>
    </div>

    <div id="conclusion" class="step" data-x="2700" data-y="1000" data-scale="1">
        <h1>Vers l'infini et au delà</h1>
		<br/>
        <ul>
          <li><b>Association francophone :</b> postgresql.fr/</li>
          <li><b>Manifestations :</b> RMLL, FOSDEM, Solutions Linux et <b>PgDay-France</b></li>
          <li><b>PostgreSQL Magazine :</b> pgmag.org</li>
          <li><b>Developpeurs :</b> blog.guillaume.lelarge.info / tapoueh.org</li>
        </ul>
        <br/>
        <blockquote>Ne restez pas seuls ...</blockquote>
        <br/><br/>
       <a href="https://github.com/blackheaven/postgresql-jdll-2012">Présentation disponible sur : https://github.com/blackheaven/postgresql-jdll-2012</a>
    </div>

    <div id="nosql" class="step" data-x="7000" data-y="1000" data-scale="1">
        <h1>NoSQL</h1>
        <ul>
          <li>API HTTP RESTful (presque) et RPC (ngx_postgres),</li>
          <li>Support de map/reduce,</li>
          <li><b>Clé-valeur :</b> modèle actuel,</li>
          <li><b>Colonne :</b> modèle actuel / hstore (GiST),</li>
          <li><b>Graphe :</b> PostGIS (GiST),</li>
          <li><b>Document :</b> JSON (GiST).</li>
        </ul>
    </div>

    <div id="nosql2" class="step" data-x="7000" data-y="2000" data-scale="1">
        <h1>NoSQL : hstore</h1>
        <pre><code>SELECT 'foo=>bar'::hstore;</code></pre>
        <pre><code>SELECT doc -> ‘text’ as tweet,
doc -> ‘created_at’ as created_at
FROM tweets
WHERE doc @> ‘created_at=>00001323446095’;</code></pre>
    </div>

    <div id="nosql3" class="step" data-x="7000" data-y="3000" data-scale="1">
        <h1>NoSQL : JSON</h1>
        <pre><code>SELECT json_array_agg(...) FROM ...</code></pre>
        <pre><code>SELECT json_object_agg(...) FROM ...</code></pre>
        <pre><code>CREATE INDEX clef_in_json
ON messages (jmember(jsonfield,'titre'));</code></pre>
        <pre><code>SELECT * FROM messages
WHERE jmember(jsonfield, 'titre') = 'foo';</code></pre>
    </div>

    <div id="asynchrone" class="step" data-x="7000" data-y="4000" data-scale="1">
        <h1>Event Driven Architecture</h1>

        <ul>
          <li>C10k problem,</li>
          <li>libpq,</li>
          <li>depuis la 7.1 (au moins), en 2001.</li>
        </ul>

        Exemple :
        <ul>
          <li>libevent (NGINX),</li>
          <li>EventMachine (Ruby : Thin, Rack, RoR),</li>
          <li>Node.js,</li>
          <li>ActiveMQ, RabbitMQ, ZeroMQ, etc.</li>
        </ul>
    </div>

    <!--

        So to make a summary of all the possible attributes used to position presentation steps, we have:

        * `data-x`, `data-y`, `data-z` - they define the position of **the center** of step element on
            the canvas in pixels; their default value is 0;
        * `data-rotate-x`, `data-rotate-y`, 'data-rotate-z`, `data-rotate` - they define the rotation of
            the element around given axis in degrees; their default value is 0; `data-rotate` and `data-rotate-z`
            are exactly the same;
        * `data-scale` - defines the scale of step element; default value is 1

        These values are used by impress.js in CSS transformation functions, so for more information consult
        CSS transfrom docs: https://developer.mozilla.org/en/CSS/transform

    -->
    
    
    
    <div id="pgplsql" class="step" data-x="12000" data-y="4000" data-scale="1">
    <h1>Procédures stockées</h1>
    
    	<ul>
			<li>Compense les manques de SQL (instructions)</li>    	
			<li>Boucles, variables, curseurs, exceptions</li>    	
			<li>PlpgSQL, Pl/Tcl, Pl/Perl et Pl/Python</li>    	
		</ul>	
			
			<pre><code>SELECT * INTO maligne </code></pre>
			<pre><code>FROM livre WHERE titre = l_titre;</code></pre>
			<pre><code>IF NOT FOUND THEN</code></pre>
    		<pre><code>RAISE EXCEPTION 'livre % introuvable', l_titre;</code></pre>
			<pre><code>END IF;</code></pre>
    </div>
    
    <div id="triggers" class="step" data-x="12000" data-y="6000" data-scale="1">
    <h1>Triggers</h1>
    
    	<ul>
			<li>Déclenchement automatique d'une procédure</li>    	
			<li>Avant ou après</li>    	
			<li>SELECT, UPDATE, REMOVE</li>    	
		</ul>	
			
			<pre><code>CREATE TRIGGER trig_biblio</code></pre>
    		<pre><code>AFTER INSERT OR UPDATE OR DELETE ON livre</code></pre>
    		<pre><code>FOR EACH ROW EXECUTE </code></pre>
    		<pre><code>PROCEDURE mise_a_jour_biblio();</code></pre>
    </div>
    
    
    
    <div id="overview" class="step" data-x="1000" data-y="0500" data-scale="15">
        <img src="img/logo.svg" width="90%" height="90%" />
    </div>

</div>

<script src="lib/impress.js/js/impress.js"></script>
<script>impress().init();</script>
<script src="lib/highlight.js/build/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

</body>
</html>
